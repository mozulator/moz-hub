<%- include('partials/head', { title: 'Overview' }) %>
<%- include('partials/nav') %>

<main class="container page">
  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Monthly Overview</h1>
      <p class="page-description">Track your spending by category</p>
    </div>
    
    <!-- Month Selector -->
    <div class="select-wrapper">
      <select 
        id="month-selector"
        onchange="window.location.href=(window.__BT_BASE_PATH__ || '') + '/overview?month=' + this.value"
        class="select">
        <% availableMonths.forEach(m => { %>
          <option value="<%= m.value %>" <%= m.value === month ? 'selected' : '' %>><%= m.label %></option>
        <% }) %>
      </select>
      <div class="select-icon">
        <i data-lucide="chevron-down"></i>
      </div>
    </div>
  </div>
  
  <!-- Summary Card -->
  <div class="card summary-card">
    <div class="summary-header">
      <div>
        <p class="label">Total Spent</p>
        <p class="value"><%= formatCurrency(totalSpent) %></p>
      </div>
      <div class="summary-meta">
        <i data-lucide="calendar"></i>
        <span class="text-sm"><%= availableMonths.find(m => m.value === month)?.label || month %></span>
      </div>
    </div>
    
    <!-- Mini bar chart -->
    <div class="summary-bar">
      <% paymentTypes.forEach((pt, index) => { %>
        <div 
          class="summary-bar-segment"
          style="width: <%= pt.percentage %>%; background-color: <%= getColorHex(pt.color) %>;"
          title="<%= pt.name %>: <%= pt.percentage %>%">
        </div>
      <% }) %>
    </div>
  </div>
  
  <!-- Payment Type Cards Grid -->
  <div class="grid grid-cols-1 grid-cols-2 grid-cols-3">
    <% paymentTypes.forEach((pt, index) => { %>
      <a href="<%= basePath %>/payment-types/<%= pt.id %>?month=<%= month %>" class="card card-hover category-card">
        
        <!-- Header -->
        <div class="category-card-header">
          <div class="category-icon" style="background-color: <%= getColorBg(pt.color) %>">
            <i data-lucide="<%= pt.icon %>" style="color: <%= getColorHex(pt.color) %>"></i>
          </div>
          <span class="category-badge" style="background-color: <%= getColorBg(pt.color) %>; color: <%= getColorHex(pt.color) %>">
            <%= pt.percentage %>%
          </span>
        </div>
        
        <!-- Content -->
        <h3 class="category-name"><%= pt.name %></h3>
        <p class="category-amount"><%= formatCurrency(pt.monthlyTotal) %></p>
        
        <!-- Footer -->
        <div class="category-footer">
          <span><%= pt.paymentCount %> payment<%= pt.paymentCount !== 1 ? 's' : '' %></span>
          <span class="category-arrow">
            <i data-lucide="arrow-right"></i>
          </span>
        </div>
      </a>
    <% }) %>
  </div>
  
  <% if (paymentTypes.length === 0) { %>
    <div class="empty-state">
      <div class="empty-icon">
        <i data-lucide="inbox"></i>
      </div>
      <h3 class="empty-title">No spending data</h3>
      <p class="empty-description">Import your bank statement for this month to see your spending breakdown.</p>
      <a href="<%= basePath %>/payments?month=<%= month %>" class="btn btn-primary">
        <i data-lucide="upload"></i>
        <span>Import Payments</span>
      </a>
    </div>
  <% } %>
</main>

<%- include('partials/footer') %>

<%
// Helper functions for colors - these run server-side
function getColorHex(color) {
  const colors = {
    rose: '#e11d48',
    emerald: '#059669',
    sky: '#0284c7',
    amber: '#d97706',
    violet: '#7c3aed',
    red: '#dc2626',
    fuchsia: '#c026d3',
    slate: '#475569',
  };
  return colors[color] || '#71717a';
}

function getColorBg(color) {
  const colors = {
    rose: '#ffe4e6',
    emerald: '#d1fae5',
    sky: '#e0f2fe',
    amber: '#fef3c7',
    violet: '#ede9fe',
    red: '#fee2e2',
    fuchsia: '#fae8ff',
    slate: '#f1f5f9',
  };
  return colors[color] || '#f4f4f5';
}
%>
